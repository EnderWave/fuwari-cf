---
title: String
published: 2025-11-28
description: 'å­—ç¬¦ä¸²'
image: ''
tags: [String]
category: 'String'
draft: false 
lang: ''
---
# å­—ç¬¦ä¸²
*å­ä¸²å¯ä»¥çœ‹æˆ**å‰ç¼€**çš„ä¸€ä¸ª**åç¼€***
## å‰ç¼€å‡½æ•°
$\pi[i]$æ˜¯$s[0...i]$æœ€é•¿çš„ç›¸ç­‰çš„**çœŸå‰ç¼€**ä¸**çœŸåç¼€**çš„é•¿åº¦ã€‚
$\pi[i]=\max_{k=0...i}k,s[0...k-1]=s[i-k+1...i]$
ç‰¹åˆ«çš„è§„å®š$\pi[0]=0$
å‡è®¾æˆ‘ä»¬å·²ç»çŸ¥é“å‰$i$ä¸ª$\pi$å‡½æ•°å€¼ï¼Œè€ƒè™‘è®¡ç®—$\pi[i+1]$,å¦‚æœ$s[i+1]=s[\pi[i]+1]$,é‚£ä¹ˆï¼Œ$\pi[i+1]=\pi[i]+1$,å¦‚æœä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬è€ƒè™‘æ‰¾åˆ°ä¸€ä¸ª**ç¬¬äºŒé•¿**çš„ç›¸ç­‰çš„çœŸå‰ç¼€ä¸çœŸåç¼€çš„é•¿åº¦ï¼Œå‘ç°$s[0...\pi[i]]å’Œs[i-\pi[i]+1...i]$**å®Œå…¨ç›¸ç­‰**ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ‰¾çš„**ç¬¬äºŒé•¿**æ˜¯ä¸æ˜¯å°±æ˜¯$s[0...\pi[i]]$çš„**æœ€é•¿**ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¿™æ ·ä¸€æ­¥ä¸€æ­¥è·³å³å¯ã€‚
```cpp
void pre(string s){
    int len=s.length();
    pi[0]=0;
    for (int i=1;i<len;i++){
        int j=pi[i-1];
        while(j&&s[i]!=s[j])j=pi[j-1];
        pi[i]=j+(s[i]==s[j]);
    }
}
```
## KMP
ç»™å®šä¸€ä¸ªæ–‡æœ¬ ğ‘¡å’Œä¸€ä¸ªå­—ç¬¦ä¸² ğ‘ ï¼Œæˆ‘ä»¬å°è¯•æ‰¾åˆ°å¹¶å±•ç¤º ğ‘  åœ¨ ğ‘¡ ä¸­çš„æ‰€æœ‰å‡ºç°
æˆ‘ä»¬å‘ç°ï¼Œåªè¦å¤„ç†$s+$ # $+t$å°±å¯ä»¥ #ä»£æŒ‡ä¸åœ¨$s,t$çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦
ä»£ç åŒä¸Š
## ACè‡ªåŠ¨æœº
Trie ä¸Šçš„è‡ªåŠ¨æœº
å»ºç«‹éœ€è¦ä¸¤ä¸ªæ­¥éª¤
**1.åŸºç¡€çš„ Trie ç»“æ„ï¼šå°†æ‰€æœ‰çš„æ¨¡å¼ä¸²æ„æˆä¸€æ£µ Trieï¼›**
**2.KMP çš„æ€æƒ³ï¼šå¯¹ Trie æ ‘ä¸Šæ‰€æœ‰çš„ç»“ç‚¹æ„é€ å¤±é…æŒ‡é’ˆã€‚**
å­—å…¸æ ‘æ­£å¸¸å»ºæ ‘å°±å¯ä»¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹**å¤±é…æŒ‡é’ˆ**
**failæŒ‡é’ˆ**æŒ‡å‘**æ‰€æœ‰**æ¨¡å¼ä¸²çš„å‰ç¼€ä¸­åŒ¹é…**å½“å‰**çŠ¶æ€çš„æœ€é•¿åç¼€ï¼Œä¸Šæ–‡çš„$\pi$æŒ‡å‘**æœ¬**æ¨¡å¼ä¸²ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è€ƒè™‘æ€ä¹ˆè®¡ç®—**failå‡½æ•°**
ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œå‘ç°å…¶å®å’Œ$\pi$å‡½æ•°æ±‚æ³•æ˜¯ä¸€æ ·çš„ã€‚
è€ƒè™‘å­—å…¸æ ‘ä¸­å½“å‰çš„ç»“ç‚¹ ğ‘¢ï¼Œğ‘¢çš„çˆ¶ç»“ç‚¹æ˜¯ ğ‘ï¼Œğ‘é€šè¿‡å­—ç¬¦ ğ‘çš„è¾¹æŒ‡å‘ ğ‘¢ï¼Œå³ $trieâ¡(ğ‘,ğ‘) =ğ‘¢$ã€‚å‡è®¾æ·±åº¦**å°äº ğ‘¢** çš„æ‰€æœ‰ç»“ç‚¹çš„$fail$æŒ‡é’ˆéƒ½å·²æ±‚å¾—ã€‚
1.å¦‚æœ $trieâ¡(failâ¡(ğ‘),ğ‘) $**å­˜åœ¨**ï¼šåˆ™è®© ğ‘¢çš„ fail æŒ‡é’ˆæŒ‡å‘ $trieâ¡(failâ¡(ğ‘),ğ‘)$ã€‚ç›¸å½“äºåœ¨ $ğ‘$å’Œ $failâ¡(ğ‘)$åé¢åŠ ä¸€ä¸ªå­—ç¬¦ ğ‘ï¼Œåˆ†åˆ«å¯¹åº” ğ‘¢ å’Œ $failâ¡(ğ‘¢)$ï¼›
2.å¦‚æœ $trieâ¡(failâ¡(ğ‘),ğ‘) $**ä¸å­˜åœ¨**ï¼šé‚£ä¹ˆæˆ‘ä»¬ç»§ç»­æ‰¾åˆ° $trieâ¡(failâ¡(failâ¡(ğ‘)),ğ‘)$ã€‚é‡å¤åˆ¤æ–­è¿‡ç¨‹ï¼Œä¸€ç›´è·³$fail$æŒ‡é’ˆç›´åˆ°æ ¹ç»“ç‚¹ï¼›
3.å¦‚æœä¾ç„¶**ä¸å­˜åœ¨**ï¼Œå°±è®© $fail$ æŒ‡é’ˆæŒ‡å‘æ ¹ç»“ç‚¹ã€‚
#### å»ºæ ‘è¿‡ç¨‹
æ¯”è¾ƒæŠ½è±¡ï¼Œä»€ä¹ˆæ—¶å€™æˆ‘æƒ³åˆ°ä¸€ä¸ªè¯´æ³•æˆ‘å†è¯¦ç»†è¯´
æˆ‘ä»¬è€ƒè™‘ä¼˜åŒ–ä¸€ä¸‹ç¬¬äºŒæ­¥çš„è·³è·ƒï¼Œå‘ç°è¿™æ˜¯åœ¨è·³$fail$æŒ‡é’ˆï¼Œå¦‚æœæˆ‘ä»¬å°†$fail$æŒ‡é’ˆçš„ç»“æ„åŠ åˆ°æ ‘ä¸Šä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ
```cpp
void build(){
    //å»ºç«‹acè‡ªåŠ¨æœº
    while (!Q.empty()) Q.pop();
    for (int i=0;i<26;i++)
        if (T[0].son[i])Q.push(T[0].son[i]);
    while (!Q.empty()){
        int u=Q.front();Q.pop();
        for (int i=0;i<26;i++){
            if (T[u].son[i]){
                T[T[u].son[i]].fail=T[T[u].fail].son[i];
                Q.push(T[u].son[i]);
            }
            else T[u].son[i]=T[T[u].fail].son[i];//æ”¹å˜æ ‘çš„ç»“æ„
        }
    }
}
```
ç®€å•ç”»ä¸ªå›¾ï¼Œæˆ‘ä»¬å‘ç°æ”¹å˜æ ‘çš„ç»“æ„å¸®æˆ‘ä»¬ä¸€æ¬¡è·³åˆ°äº†æ‰€éœ€ä½ç½®ï¼ˆåæœŸå†è¡¥ï¼‰
### æŸ¥è¯¢æ“ä½œåŠå…¶ä¼˜åŒ–
é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘ACAMä¸Šæ¯ä¸ªèŠ‚ç‚¹æ˜¯ä»€ä¹ˆæ„æ€ã€‚æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„**å‰ç¼€**ï¼ˆä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹æ‰€ç»è¿‡çš„è¾¹å½¢æˆçš„å‰ç¼€ï¼‰ã€‚æˆ‘ä»¬ç§°å…¶ä¸ºè¯¥ç‚¹çš„çŠ¶æ€ã€‚
é‚£æˆ‘ä»¬çš„$fail$æŒ‡é’ˆåˆæ˜¯å¹²ä»€ä¹ˆçš„çš„å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°ï¼Œ$fail$æŒ‡é’ˆæŒ‡å‘å½“å‰ç©¿çš„æœ€é•¿çš„**åç¼€**ã€‚
é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¯æ¬¡æŸ¥å¯»åˆ°ä¸€ä¸ªç‚¹ï¼Œé¦–å…ˆï¼Œèƒ½è¾¾åˆ°è¯¥ç‚¹çš„çŠ¶æ€ï¼Œç„¶åå…¶$fail$æ‰€æŒ‡çš„çŠ¶æ€ä¹Ÿèƒ½è¾¾åˆ°ï¼Œæ¯æ¬¡åˆ°ä¸€ä¸ªç‚¹ï¼Œæˆ‘ä»¬å°±è·³$fail$æ¥ç»Ÿè®¡ç­”æ¡ˆã€‚
å‘ç°æ¯æ¬¡éƒ½è¦è·³ï¼Œå¾ˆæµªè´¹ï¼Œæˆ‘ä»¬åˆåªéœ€è¦åœ¨$fail$ä¸Šè·³ï¼ˆæ˜¾ç„¶$fail$æ‰€å½¢æˆçš„æ˜¯DAGï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ç”¨æ‹“æ‰‘æ’åºä¼˜åŒ–ã€‚
```cpp
void qry(string t){
    int u=0,len=t.length();
    for (int i=0;i<len;i++){
        u=T[u].son[t[i]-'a'];
        T[u].ans++;
    }
}
void topo(){
    while (!Q.empty()) Q.pop();
    for (int i=0;i<=cntn;i++){
        if (!T[i].in)Q.push(i);
    }
    while (!Q.empty()){
        int u=Q.front();Q.pop();
        ans[T[u].id]=T[u].ans;
        int v=T[u].fail;
        T[v].ans+=T[u].ans;
        if (!--T[v].in)Q.push(v);
    }
}
```
[ACè‡ªåŠ¨æœºæ¨¡æ¿](https://www.luogu.com.cn/problem/P5357)
ACAMå®Œæ•´ä»£ç 
```cpp
namespace ACAM {
    struct tire{
        int son[26],fail,in,id,ans;
        void clear(){
            fail=in=id=ans=0;
            memset(son,0,sizeof(son));
        }
    }T[N];
    int cntid,cntn,ans[N];
    queue<int>Q;
    void init(){
        cntid=cntn=0;
        T[0].clear();
    }
    int insert(string s){//return id;
        int u=0,len=s.length();
        for (int i=0;i<len;i++){
            int& son=T[u].son[s[i]-'a'];//åœ°å€å†™æ³•æ›´æ–¹ä¾¿
            if (!son)son=++cntn,T[son].clear();
            u=son;
        }
        if (!T[u].id)T[u].id=++cntid;//é˜²æ­¢é‡å¤
        return T[u].id;//è®°å½•ç¼–å·
    }
    void build(){
        //å»ºç«‹acè‡ªåŠ¨æœº
        while (!Q.empty()) Q.pop();
        for (int i=0;i<26;i++)
            if (T[0].son[i])Q.push(T[0].son[i]);
        while (!Q.empty()){
            int u=Q.front();Q.pop();
            for (int i=0;i<26;i++){
                if (T[u].son[i]){
                    T[T[u].son[i]].fail=T[T[u].fail].son[i];
                    T[T[T[u].fail].son[i]].in++;
                    Q.push(T[u].son[i]);
                }
                else T[u].son[i]=T[T[u].fail].son[i];//æ”¹å˜æ ‘çš„ç»“æ„
            }
        }
    }
    void qry(string t){
        int u=0,len=t.length();
        for (int i=0;i<len;i++){
            u=T[u].son[t[i]-'a'];
            T[u].ans++;
        }
    }
    void topo(){
        while (!Q.empty()) Q.pop();
        for (int i=0;i<=cntn;i++){
            if (!T[i].in)Q.push(i);
        }
        while (!Q.empty()){
            int u=Q.front();Q.pop();
            ans[T[u].id]=T[u].ans;
            int v=T[u].fail;
            T[v].ans+=T[u].ans;
            if (!--T[v].in)Q.push(v);
        }
    }
}
```
### ACAMä¸Šçš„DP
